apiVersion: source.extensions.fluxcd.io/v1beta1
kind: ArtifactGenerator
metadata:
  name: podinfo
spec:
  # Sources is a list of references to Flux source-controller resources
  # (GitRepository, OCIRepository and Bucket) that will be
  # used to generate ExternalArtifact resources.
  sources:
    - alias: chart
      kind: OCIRepository
      name: podinfo-chart
    - alias: repo
      kind: GitRepository
      name: podinfo-values
  # Artifacts is a list of ExternalArtifact resources to be generated
  # from the specified sources.
  artifacts:
    # ExternalArtifact resources are generated by copying files from one or more sources.
    # The `name` field specifies the name of the generated ExternalArtifact resource.
    # The namespace of the generated resource is the same as the ArtifactGenerator resource.
    # The `from` field specifies the source (by alias) and the glob pattern to match files.
    # The `to` field specifies the destination path in the generated artifact resource.
    # The copy operations are performed in the order they are listed with existing files
    # being overwritten by later copy operations.
    # The `revision` field specifies the source revision to use for the artifact.
    # It can be set to a source alias to use the latest revision of that source,
    # or if left empty, the revision is automatically set to the digest of the artifact content.
    - name: podinfo
      revision: "@chart"
      copy:
        - from: "@chart/**"
          to: "@artifact/"
        - from: "@repo/charts/podinfo/values-prod.yaml"
          to: "@artifact/values.yaml"
